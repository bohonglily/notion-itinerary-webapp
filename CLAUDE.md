# Notion Itinerary WebApp å°ˆæ¡ˆèªªæ˜æ–‡ä»¶

# è¡Œç‚ºæº–å‰‡
- æ¯ç•¶æ›´æ–°ç¨‹å¼ç¢¼æ™‚ï¼ŒåŒæ™‚æ›´æ–°ç›¸é—œçš„ CLAUDE.md æ–‡ä»¶å…§å®¹ï¼Œä¿æŒèªªæ˜èˆ‡ä»£ç¢¼åŒæ­¥ã€‚
- ä¸éœ€æ¯æ¬¡ä½ ç‰¹åˆ¥æé†’ï¼Œé€™æ˜¯å®ƒåœ¨è™•ç†ä¿®æ”¹ä»»å‹™æ™‚çš„ã€Œè‡ªå‹•æµç¨‹ã€ä¹‹ä¸€ã€‚

## å°ˆæ¡ˆæ¦‚è¿°

**Notion Itinerary WebApp** æ˜¯ä¸€å€‹åŸºæ–¼ React + TypeScript çš„ç¾ä»£åŒ–æ—…éŠè¡Œç¨‹å±•ç¤ºç³»çµ±ï¼Œèˆ‡ Notion è³‡æ–™åº«æ·±åº¦æ•´åˆï¼Œæä¾›ç¾è§€çš„æ™‚é–“è»¸ä»‹é¢ä¾†å±•ç¤ºæ—…éŠè¡Œç¨‹ã€‚ç³»çµ±æ”¯æ´å¤šç¨® AI æœå‹™é€²è¡Œå…§å®¹å¢å¼·ï¼ŒåŒ…å«è‡ªå‹•ç”Ÿæˆæ™¯é»ä»‹ç´¹å’Œåœ–ç‰‡æœå°‹åŠŸèƒ½ã€‚**æ¡ç”¨æ··åˆæ¶æ§‹è¨­è¨ˆï¼šå‰ç«¯ä½¿ç”¨ TypeScript ä¿æŒå‹åˆ¥å®‰å…¨ï¼Œå¾Œç«¯ä½¿ç”¨ç´” JavaScript ç¢ºä¿éƒ¨ç½²ç©©å®šæ€§ï¼Œæ”¯æ´ Netlifyã€Vercel ç­‰å¤šå€‹å¹³å°ã€‚**

## æ ¸å¿ƒåŠŸèƒ½ç‰¹è‰²

### ğŸ—‚ï¸ Notion æ•´åˆ
- ç›´æ¥é€£æ¥ Notion è³‡æ–™åº«è®€å–æ—…éŠè¡Œç¨‹è³‡æ–™
- æ”¯æ´å³æ™‚è³‡æ–™åŒæ­¥èˆ‡æ›´æ–°
- å®Œæ•´çš„ CRUD æ“ä½œï¼ˆé€éå¤šå¹³å° Serverless Functionsï¼‰

### ğŸ§  AI æ™ºèƒ½å¢å¼·
- **å¤š AI æä¾›å•†æ”¯æ´**ï¼šGoogle Geminiã€OpenAIã€Claudeã€OpenRouter
- **æ™ºèƒ½é™ç´šæ©Ÿåˆ¶**ï¼šç•¶ä¸»è¦ AI æœå‹™å¤±æ•ˆæ™‚è‡ªå‹•åˆ‡æ›
- **è‡ªå‹•æ™¯é»ä»‹ç´¹ç”Ÿæˆ**ï¼šåˆ©ç”¨ AI ç‚ºæ™¯é»ç”Ÿæˆè©³ç´°ä»‹ç´¹
- **æ‰¹é‡è™•ç†**ï¼šæ”¯æ´æ‰¹é‡ç”Ÿæˆæ™¯é»ä»‹ç´¹

### ğŸ–¼ï¸ åœ–ç‰‡ç®¡ç†
- æ•´åˆ Pexels API è‡ªå‹•æœå°‹æ™¯é»ç¸®åœ–
- æ”¯æ´æ‰¹é‡åœ–ç‰‡æœå°‹å’Œæ›´æ–°
- åœ–ç‰‡ä»£ç†æœå‹™ï¼ˆé¿å… CORS å•é¡Œï¼‰

### ğŸ“ åƒè€ƒè³‡æ–™ç®¡ç†
- **æ™ºèƒ½é€£çµæ¸²æŸ“**ï¼š`(URL)` æ ¼å¼è‡ªå‹•è½‰æ›ç‚ºå¯é»æ“Šçš„ ğŸ”— é€£çµ
- **å¤šé€£çµæ”¯æ´**ï¼šä¸€å€‹æ¬„ä½å¯åŒ…å«å¤šå€‹åƒè€ƒè³‡æ–™é€£çµ
- **ç°¡åŒ–è¼¸å…¥**ï¼šåªéœ€åœ¨æ‹¬è™Ÿå…§è¼¸å…¥ URLï¼Œç„¡éœ€è¤‡é›œ Markdown èªæ³•
- **è¦–è¦ºçµ±ä¸€**ï¼šæ‰€æœ‰é€£çµçµ±ä¸€é¡¯ç¤ºç‚º ğŸ”— é€£çµ æ ¼å¼

### ğŸ’¾ æ™ºèƒ½å¿«å–ç³»çµ±
- æœ¬åœ°ç€è¦½å™¨å¿«å–æ©Ÿåˆ¶
- æ¸›å°‘ API å‘¼å«é »ç‡
- æ”¯æ´å¿«å–æ¸…é™¤å’Œé‡æ–°æ•´ç†

### ğŸ¨ ç¾ä»£åŒ– UI/UX
- éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´æ‰‹æ©Ÿå’Œæ¡Œé¢è£ç½®
- æ™‚é–“è»¸å¼è¡Œç¨‹å±•ç¤º
- æµ®å‹•å¼æ“ä½œé¸å–®
- æ·±è‰²æ¨¡å¼åˆ‡æ›ï¼ˆéƒ¨åˆ†å¯¦ä½œï¼‰
- æ™¯é»ä»‹ç´¹é¡¯ç¤º/éš±è—åˆ‡æ›
- **åƒè€ƒè³‡æ–™æ™ºèƒ½é€£çµ**ï¼šæ”¯æ´ `(URL)` æ ¼å¼è‡ªå‹•æ¸²æŸ“ç‚º ğŸ”— é€£çµ

### ğŸ” ç®¡ç†è€…åŠŸèƒ½
- å¯†ç¢¼ä¿è­·çš„ç®¡ç†é¢æ¿
- AI å…§å®¹æ‰¹é‡å¢å¼·
- ç³»çµ±è¨­å®šç®¡ç†
- è³‡æ–™é‡æ–°è¼‰å…¥

### ğŸ“Š åˆ†å±¤ç´šæ—¥èªŒç³»çµ±
- **å¤šå±¤ç´šæ—¥èªŒ**ï¼šDEBUGã€INFOã€WARNã€ERROR
- **åˆ†é¡æ¨™ç±¤**ï¼šAPIã€USERã€SYSTEMã€PERFORMANCEã€AI_MANAGERã€NOTIONã€ERROR_BOUNDARY
- **æ™ºèƒ½ç’°å¢ƒåˆ‡æ›**ï¼šé–‹ç™¼ç’°å¢ƒé¡¯ç¤ºè©³ç´°æ—¥èªŒï¼Œç”Ÿç”¢ç’°å¢ƒåƒ…é¡¯ç¤ºé—œéµè³‡è¨Š
- **æ•ˆèƒ½ç›£æ§**ï¼šAPI è«‹æ±‚æ™‚é–“ã€æ“ä½œè€—æ™‚è¿½è¹¤
- **ç”¨æˆ¶è¡Œç‚ºè¿½è¹¤**ï¼šé é¢ç€è¦½ã€åŠŸèƒ½ä½¿ç”¨ã€éŒ¯èª¤è¨˜éŒ„
- **å¤–éƒ¨æœå‹™æ•´åˆ**ï¼šæ”¯æ´ç™¼é€éŒ¯èª¤æ—¥èªŒåˆ°å¤–éƒ¨ç›£æ§æœå‹™

## æŠ€è¡“æ¶æ§‹

### å‰ç«¯æŠ€è¡“æ£§
```
React 18 + TypeScript
â”œâ”€â”€ ç‹€æ…‹ç®¡ç†ï¼šTanStack Query (React Query)
â”œâ”€â”€ æ¨£å¼æ¡†æ¶ï¼šTailwind CSS
â”œâ”€â”€ åœ–ç¤ºï¼šLucide React
â”œâ”€â”€ è·¯ç”±ï¼šReact Router DOM
â””â”€â”€ å»ºç½®å·¥å…·ï¼šVite
```

### å¾Œç«¯æœå‹™ï¼ˆæ··åˆ Serverless æ¶æ§‹ï¼‰
```
å¤šå¹³å° Serverless Functions (ç´” JavaScript)
â”œâ”€â”€ å…±ç”¨å·¥å…·å±¤
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ notion-client.js        # å…±ç”¨ Notion API å·¥å…·å‡½æ•¸
â”‚           â”œâ”€â”€ transformNotionPage()    # è³‡æ–™æ ¼å¼è½‰æ›
â”‚           â”œâ”€â”€ buildNotionQuery()       # æŸ¥è©¢æ¢ä»¶å»ºæ§‹
â”‚           â”œâ”€â”€ getNotionHeaders()       # API æ¨™é ­è¨­å®š
â”‚           â”œâ”€â”€ getCorsHeaders()         # CORS æ¨™é ­çµ±ä¸€
â”‚           â”œâ”€â”€ createErrorResponse()    # éŒ¯èª¤å›æ‡‰æ ¼å¼åŒ–
â”‚           â”œâ”€â”€ createSuccessResponse()  # æˆåŠŸå›æ‡‰æ ¼å¼åŒ–
â”‚           â””â”€â”€ buildNotionProperties()  # å±¬æ€§å°è±¡å»ºæ§‹
â”œâ”€â”€ å¹³å°å¯¦ä½œå±¤
â”‚   â”œâ”€â”€ netlify/functions/          # Netlify Functions (JavaScript)
â”‚   â”‚   â”œâ”€â”€ notion-query.js
â”‚   â”‚   â”œâ”€â”€ notion-create.js
â”‚   â”‚   â”œâ”€â”€ notion-update.js
â”‚   â”‚   â”œâ”€â”€ notion-delete.js
â”‚   â”‚   â”œâ”€â”€ notion-bulk-update.js
â”‚   â”‚   â”œâ”€â”€ notion-database-info.js
â”‚   â”‚   â””â”€â”€ image-proxy.js
â”‚   â””â”€â”€ api/                       # Vercel API Routes (JavaScript)
â”‚       â”œâ”€â”€ notion-query.js
â”‚       â”œâ”€â”€ notion-create.js
â”‚       â”œâ”€â”€ notion-update.js
â”‚       â”œâ”€â”€ notion-delete.js
â”‚       â”œâ”€â”€ notion-bulk-update.js
â”‚       â”œâ”€â”€ notion-database-info.js
â”‚       â””â”€â”€ image-proxy.js
â””â”€â”€ å‰ç«¯æœå‹™å·¥å» 
    â””â”€â”€ src/services/api-service-factory.ts # æ™ºèƒ½ç«¯é»é¸æ“‡
```

### å¤–éƒ¨ API æ•´åˆ
- **Notion API**ï¼šè¡Œç¨‹è³‡æ–™ä¾†æº
- **Pexels API**ï¼šåœ–ç‰‡æœå°‹æœå‹™
- **AI æœå‹™**ï¼šGoogle Geminiã€OpenAIã€Claudeã€OpenRouter

## å°ˆæ¡ˆçµæ§‹è©³è§£

```
notion-itinerary-webapp/
â”œâ”€â”€ src/                    # å‰ç«¯ TypeScript ä»£ç¢¼
â”‚   â”œâ”€â”€ components/          # React å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ AdminPanel.tsx           # ç®¡ç†è€…é¢æ¿
â”‚   â”‚   â”œâ”€â”€ AdminPasswordPrompt.tsx  # ç®¡ç†è€…å¯†ç¢¼é©—è­‰
â”‚   â”‚   â”œâ”€â”€ TravelCard.tsx           # è¡Œç¨‹å¡ç‰‡å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ TravelCardEditModal.tsx  # è¡Œç¨‹ç·¨è¼¯æ¨¡æ…‹æ¡†
â”‚   â”‚   â”œâ”€â”€ TravelTimeline.tsx       # æ™‚é–“è»¸ä¸»è¦å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ DayTabs.tsx             # æ—¥æœŸåˆ†é 
â”‚   â”‚   â”œâ”€â”€ AddItineraryModal.tsx   # æ–°å¢è¡Œç¨‹æ¨¡æ…‹æ¡†
â”‚   â”‚   â”œâ”€â”€ Modal.tsx               # é€šç”¨æ¨¡æ…‹æ¡†
â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.tsx      # è¼‰å…¥å‹•ç•«
â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.tsx       # éŒ¯èª¤é‚Šç•Œ
â”‚   â”‚   â”œâ”€â”€ HomePage.tsx            # é¦–é å…ƒä»¶
â”‚   â”‚   â””â”€â”€ ItineraryFormFields.tsx # è¡Œç¨‹è¡¨å–®æ¬„ä½å…ƒä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ services/           # å‰ç«¯æœå‹™å±¤
â”‚   â”‚   â”œâ”€â”€ ai/                     # AI æœå‹™æŠ½è±¡å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-manager.ts       # AI ç®¡ç†å™¨ï¼ˆä¸»è¦å…¥å£ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ abstract-ai-provider.ts  # AI æä¾›å•†æŠ½è±¡é¡åˆ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini-provider.ts  # Google Gemini å¯¦ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ openai-provider.ts  # OpenAI å¯¦ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ claude-provider.ts  # Claude å¯¦ä½œ
â”‚   â”‚   â”‚   â””â”€â”€ openrouter-provider.ts # OpenRouter å¯¦ä½œ
â”‚   â”‚   â”œâ”€â”€ notion-service.ts       # Notion API æœå‹™
â”‚   â”‚   â”œâ”€â”€ pexels-service.ts       # Pexels åœ–ç‰‡æœå°‹
â”‚   â”‚   â”œâ”€â”€ cache-service.ts        # å¿«å–ç®¡ç†æœå‹™
â”‚   â”‚   â”œâ”€â”€ logger-service.ts       # åˆ†å±¤ç´šæ—¥èªŒæœå‹™
â”‚   â”‚   â””â”€â”€ api-service-factory.ts  # API ç«¯é»å·¥å» 
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/              # è‡ªè¨‚ React Hooks
â”‚   â”‚   â”œâ”€â”€ useItinerary.ts         # è¡Œç¨‹è³‡æ–™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useMode.ts              # æ¨¡å¼åˆ‡æ›ï¼ˆç€è¦½/ç·¨è¼¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ useUrlParams.ts         # URL åƒæ•¸è™•ç†
â”‚   â”‚   â”œâ”€â”€ usePerformance.ts       # æ•ˆèƒ½ç›£æ§ Hook
â”‚   â”‚   â”œâ”€â”€ useUserTracking.ts      # ç”¨æˆ¶è¡Œç‚ºè¿½è¹¤ Hook
â”‚   â”‚   â””â”€â”€ useHistory.ts           # ç€è¦½æ­·å²è¨˜éŒ„
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/           # React Contexts
â”‚   â”‚   â”œâ”€â”€ ModeContext.tsx         # æ¨¡å¼ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ VisibilityContext.tsx   # é¡¯ç¤ºç‹€æ…‹ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ config/             # è¨­å®šæª”
â”‚   â”‚   â”œâ”€â”€ ai-config.ts            # AI æœå‹™è¨­å®š
â”‚   â”‚   â””â”€â”€ ui-config.ts            # UI ç›¸é—œè¨­å®š
â”‚   â”‚
â”‚   â”œâ”€â”€ types/              # TypeScript å‹åˆ¥å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts                # ä¸»è¦å‹åˆ¥å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/              # å‰ç«¯å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ App.tsx             # ä¸»è¦ App å…ƒä»¶
â”‚   â”œâ”€â”€ main.tsx            # React æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”‚   â””â”€â”€ vite-env.d.ts       # Vite é¡å‹å®šç¾©
â”‚
â”œâ”€â”€ utils/                  # å¾Œç«¯å…±ç”¨å·¥å…· (JavaScript)
â”‚   â””â”€â”€ notion-client.js            # Notion API å…±ç”¨å‡½æ•¸
â”‚
â”œâ”€â”€ netlify/functions/      # Netlify Functions (JavaScript)
â”‚   â”œâ”€â”€ notion-query.js             # Notion è³‡æ–™æŸ¥è©¢
â”‚   â”œâ”€â”€ notion-create.js            # å»ºç«‹æ–°è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-update.js            # æ›´æ–°è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-delete.js            # åˆªé™¤è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-bulk-update.js       # æ‰¹é‡æ›´æ–°
â”‚   â”œâ”€â”€ notion-database-info.js     # è³‡æ–™åº«è³‡è¨ŠæŸ¥è©¢
â”‚   â””â”€â”€ image-proxy.js              # åœ–ç‰‡ä»£ç†æœå‹™
â”‚
â”œâ”€â”€ api/                    # Vercel API Routes (JavaScript)
â”‚   â”œâ”€â”€ notion-query.js             # Notion è³‡æ–™æŸ¥è©¢
â”‚   â”œâ”€â”€ notion-create.js            # å»ºç«‹æ–°è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-update.js            # æ›´æ–°è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-delete.js            # åˆªé™¤è¡Œç¨‹é …ç›®
â”‚   â”œâ”€â”€ notion-bulk-update.js       # æ‰¹é‡æ›´æ–°
â”‚   â”œâ”€â”€ notion-database-info.js     # è³‡æ–™åº«è³‡è¨ŠæŸ¥è©¢
â”‚   â””â”€â”€ image-proxy.js              # åœ–ç‰‡ä»£ç†æœå‹™
â”‚
â”œâ”€â”€ docs/                   # å°ˆæ¡ˆæ–‡æª”
â”‚   â”œâ”€â”€ API_DOCUMENTATION.md        # API æ–‡æª”èªªæ˜
â”‚   â”œâ”€â”€ DEVELOPER_GUIDE.md          # é–‹ç™¼è€…æŒ‡å—
â”‚   â””â”€â”€ DEPLOYMENT_GUIDE.md         # éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ public/                # éœæ…‹è³‡æº
â”œâ”€â”€ pic/                   # åœ–ç‰‡è³‡æº
â”œâ”€â”€ tmp/                   # è‡¨æ™‚æª”æ¡ˆ
â”œâ”€â”€ dist/                  # å»ºç½®ç”¢å‡º (è‡ªå‹•ç”Ÿæˆ)
â”œâ”€â”€ package.json           # å°ˆæ¡ˆç›¸ä¾æ€§
â”œâ”€â”€ vite.config.ts         # Vite è¨­å®š
â”œâ”€â”€ tailwind.config.js     # Tailwind CSS è¨­å®š
â”œâ”€â”€ tsconfig.json          # TypeScript è¨­å®šæ ¹æª”æ¡ˆ
â”œâ”€â”€ tsconfig.app.json      # App TypeScript è¨­å®š
â”œâ”€â”€ tsconfig.node.json     # Node.js TypeScript è¨­å®š
â”œâ”€â”€ eslint.config.js       # ESLint è¨­å®š
â”œâ”€â”€ postcss.config.js      # PostCSS è¨­å®š
â”œâ”€â”€ netlify.toml           # Netlify è¨­å®š
â”œâ”€â”€ README.md              # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ PROJECT_OVERVIEW.md    # å°ˆæ¡ˆæ¦‚è¦½
â””â”€â”€ CLAUDE.md              # Claude AI å°ˆæ¡ˆæŒ‡å—
```

## æ ¸å¿ƒæµç¨‹èªªæ˜

### 1. è³‡æ–™æµç¨‹
```
Notion è³‡æ–™åº« â†’ Serverless Functions (Netlify/Vercel) â†’ Frontend Cache â†’ React Components
```

### 2. AI å…§å®¹å¢å¼·æµç¨‹
```
ç”¨æˆ¶è§¸ç™¼ â†’ AI Manager â†’ é¸æ“‡å¯ç”¨çš„ AI Provider â†’ ç”Ÿæˆå…§å®¹ â†’ æ›´æ–°åˆ° Notion
```

### 3. åœ–ç‰‡æœå°‹æµç¨‹
```
æ™¯é»åç¨± â†’ Pexels API â†’ åœ–ç‰‡ URL â†’ é€é Image Proxy â†’ æ›´æ–°åˆ° Notion
```

## Notion è³‡æ–™åº«çµæ§‹

ç³»çµ±æœŸæœ›çš„ Notion è³‡æ–™åº«æ¬„ä½ï¼š

| æ¬„ä½åç¨± | å‹åˆ¥ | èªªæ˜ |
|---------|------|------|
| é …ç›® | Title | æ™¯é»/æ´»å‹•åç¨±ï¼ˆå¿…å¡«ï¼‰ |
| æ—¥æœŸ | Date | è¡Œç¨‹æ—¥æœŸ |
| æ™‚æ®µ | Multi-select | æ™‚é–“æ®µï¼ˆä¸Šåˆã€ä¸‹åˆã€æ™šä¸Šï¼‰ |
| GoogleMaps | URL | Google Maps é€£çµ |
| é‡è¦è³‡è¨Š | Rich Text | é‡è¦æ³¨æ„äº‹é … |
| åƒè€ƒè³‡æ–™ | Rich Text | åƒè€ƒè³‡æ–™å’Œé€£çµ |
| äººå‡åƒ¹ | Number | æ¯äººè²»ç”¨ |
| å‰å¾€æ–¹å¼ | Rich Text | äº¤é€šæ–¹å¼ |
| å¾…è¾¦ | Rich Text | å¾…è¾¦äº‹é … |
| ç¸®åœ–ç¶²å€ | URL | æ™¯é»åœ–ç‰‡ URL |
| æ™¯é»ä»‹ç´¹ | Rich Text | AI ç”Ÿæˆçš„æ™¯é»ä»‹ç´¹ |
| æ’åº | Number | æ’åºæ¬Šé‡ |

## ç’°å¢ƒè®Šæ•¸è¨­å®š

```env
# å¿…è¦è¨­å®š
VITE_NOTION_API_KEY=your_notion_integration_key
VITE_PEXELS_API_KEY=your_pexels_api_key
VITE_ADMIN_PASSWORD=your_admin_password

# AI æœå‹™ API Keys (è‡³å°‘éœ€è¦ä¸€å€‹)
VITE_GEMINI_API_KEY=your_gemini_api_key
VITE_OPENAI_API_KEY=your_openai_api_key
VITE_CLAUDE_API_KEY=your_claude_api_key
VITE_OPENROUTER_API_KEY=your_openrouter_api_key

# å¯é¸è¨­å®š
VITE_AI_PROVIDER=gemini  # é è¨­ AI æä¾›å•†
```

## ä½¿ç”¨æ–¹å¼

### ä¸€èˆ¬ä½¿ç”¨è€…
1. **åŸºæœ¬å­˜å–**ï¼š`https://your-domain.com?db=notion_database_id`
2. **æ—¥æœŸç¯©é¸**ï¼š`?db=database_id&start=2024-01-01&end=2024-01-31`

### ç®¡ç†è€…æ¨¡å¼
1. é»æ“Šå³ä¸‹è§’è¨­å®šé¸å–®
2. è¼¸å…¥ç®¡ç†è€…å¯†ç¢¼
3. é€²å…¥ç®¡ç†é¢æ¿é€²è¡Œä»¥ä¸‹æ“ä½œï¼š
   - é‡æ–°è¼‰å…¥ Notion è³‡æ–™
   - æ‰¹é‡æœå°‹åœ–ç‰‡
   - æ‰¹é‡ç”Ÿæˆæ™¯é»ä»‹ç´¹
   - åˆ‡æ› AI æä¾›å•†

## é–‹ç™¼èˆ‡éƒ¨ç½²

### æœ¬åœ°é–‹ç™¼

#### ğŸš€ Netlify Functions æœ¬åœ°æ¸¬è©¦
```bash
# å®‰è£ç›¸ä¾æ€§
npm install

# æ–¹å¼ 1ï¼šä½¿ç”¨é è¨­çš„ä¸¦è¡Œæ¨¡å¼ï¼ˆæ¨è–¦ï¼‰
npm run dev:netlify

# æ–¹å¼ 2ï¼šåˆ†åˆ¥å•Ÿå‹•
# çµ‚ç«¯ 1ï¼šå•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨
npm run dev

# çµ‚ç«¯ 2ï¼šå•Ÿå‹• Netlify Functions
npx netlify functions:serve
```

**Netlify Functions ç«¯é»æ ¼å¼ï¼š**
- æœ¬åœ°ï¼š`http://localhost:8888/.netlify/functions/[function-name]`
- ä¾‹å¦‚ï¼š`http://localhost:8888/.netlify/functions/notion-query`

#### ğŸŒ Vercel API Routes æœ¬åœ°æ¸¬è©¦
```bash
# ä½¿ç”¨ Vercel CLI æœ¬åœ°é–‹ç™¼ï¼ˆæ¨è–¦ï¼‰
npm run dev:vercel

# æˆ–è€…ç›´æ¥ä½¿ç”¨ Vercel CLI
npx vercel dev
```

**Vercel API Routes ç«¯é»æ ¼å¼ï¼š**
- æœ¬åœ°ï¼š`http://localhost:3000/api/[function-name]`
- ä¾‹å¦‚ï¼š`http://localhost:3000/api/notion-query`

#### ğŸ§ª API æ¸¬è©¦æ–¹æ³•

**1. ä½¿ç”¨ç€è¦½å™¨ç›´æ¥æ¸¬è©¦**
```
# Netlify Functions
http://localhost:8888/.netlify/functions/notion-database-info

# Vercel API Routes  
http://localhost:3000/api/notion-database-info
```

**2. ä½¿ç”¨ curl æ¸¬è©¦**
```bash
# æ¸¬è©¦ Notion æŸ¥è©¢ API
curl -X POST "http://localhost:8888/.netlify/functions/notion-query" \
  -H "Content-Type: application/json" \
  -d '{"databaseId":"your-database-id"}'

# æ¸¬è©¦åœ–ç‰‡ä»£ç† API
curl "http://localhost:8888/.netlify/functions/image-proxy?url=https://example.com/image.jpg"
```

**3. å¹³å°åˆ‡æ›æ¸¬è©¦**
```bash
# æª¢æ¸¬ç•¶å‰å¹³å°
npm run platform:detect

# æŸ¥çœ‹å¹³å°è©³ç´°è³‡è¨Š
npm run platform:info
```

#### ğŸ“‹ å¯ç”¨çš„ API ç«¯é»

| åŠŸèƒ½ | Netlify Functions | Vercel API Routes |
|------|------------------|-------------------|
| æŸ¥è©¢è³‡æ–™ | `/.netlify/functions/notion-query` | `/api/notion-query` |
| å»ºç«‹é …ç›® | `/.netlify/functions/notion-create` | `/api/notion-create` |
| æ›´æ–°é …ç›® | `/.netlify/functions/notion-update` | `/api/notion-update` |
| åˆªé™¤é …ç›® | `/.netlify/functions/notion-delete` | `/api/notion-delete` |
| æ‰¹é‡æ›´æ–° | `/.netlify/functions/notion-bulk-update` | `/api/notion-bulk-update` |
| è³‡æ–™åº«è³‡è¨Š | `/.netlify/functions/notion-database-info` | `/api/notion-database-info` |
| åœ–ç‰‡ä»£ç† | `/.netlify/functions/image-proxy` | `/api/image-proxy` |

### å»ºç½®èˆ‡éƒ¨ç½²
```bash
# å»ºç½®ç”¢å“ç‰ˆæœ¬
npm run build

# å¹³å°ç‰¹å®šå»ºç½®
npm run build:netlify  # é‡å° Netlify å»ºç½®
npm run build:vercel   # é‡å° Vercel å»ºç½®

# éƒ¨ç½²
npm run deploy:netlify # éƒ¨ç½²åˆ° Netlify
npm run deploy:vercel  # éƒ¨ç½²åˆ° Vercel
```

## è¨­è¨ˆæ¨¡å¼èˆ‡æ¶æ§‹äº®é»

### 1. æ··åˆæ¶æ§‹è¨­è¨ˆ
- **å‰ç«¯ TypeScript**ï¼šä¿æŒå‹åˆ¥å®‰å…¨å’Œè‰¯å¥½çš„é–‹ç™¼é«”é©—
- **å¾Œç«¯ JavaScript**ï¼šç¢ºä¿ Serverless éƒ¨ç½²ç©©å®šæ€§
- **å…±ç”¨å·¥å…·æ¨¡çµ„**ï¼šæ¸›å°‘ä»£ç¢¼é‡è¤‡ï¼Œçµ±ä¸€æ¥­å‹™é‚è¼¯
- **AI æœå‹™æŠ½è±¡åŒ–**ï¼šæ˜“æ–¼æ“´å±•æ–°çš„ AI æä¾›å•†

### 2. éŒ¯èª¤è™•ç†èˆ‡é™ç´š
- å®Œæ•´çš„éŒ¯èª¤é‚Šç•Œè¨­è¨ˆ
- AI æœå‹™å¤±æ•ˆæ™‚çš„è‡ªå‹•é™ç´šæ©Ÿåˆ¶
- å„ªé›…çš„è¼‰å…¥å’ŒéŒ¯èª¤ç‹€æ…‹é¡¯ç¤º

### 3. æ•ˆèƒ½æœ€ä½³åŒ–
- React Query å¯¦ä½œè³‡æ–™å¿«å–å’ŒåŒæ­¥
- æ‰¹é‡ API å‘¼å«æ¸›å°‘ç¶²è·¯è«‹æ±‚
- åœ–ç‰‡æ‡¶è¼‰å…¥å’Œä»£ç†æœå‹™

### 4. ä½¿ç”¨è€…é«”é©—
- éŸ¿æ‡‰å¼è¨­è¨ˆé©é…å„ç¨®è£ç½®
- ç›´è§€çš„æ™‚é–“è»¸ä»‹é¢
- å³æ™‚çš„æ“ä½œå›é¥‹

## æœªä¾†æ“´å±•å»ºè­°

1. **å¤šèªè¨€æ”¯æ´**ï¼šåœ‹éš›åŒ–åŠŸèƒ½
2. **é›¢ç·šæ¨¡å¼**ï¼šService Worker å¯¦ä½œ
3. **å”ä½œåŠŸèƒ½**ï¼šå¤šäººå…±åŒç·¨è¼¯è¡Œç¨‹
4. **åŒ¯å‡ºåŠŸèƒ½**ï¼šPDF/Excel æ ¼å¼åŒ¯å‡º
5. **è¡Œç¨‹åˆ†äº«**ï¼šç¤¾ç¾¤åˆ†äº«åŠŸèƒ½
6. **åœ°åœ–æ•´åˆ**ï¼šåµŒå…¥å¼åœ°åœ–é¡¯ç¤º

## æ—¥èªŒç³»çµ±ä½¿ç”¨æŒ‡å—

### æ—¥èªŒå±¤ç´šèªªæ˜
- **DEBUG (0)**ï¼šè©³ç´°çš„é™¤éŒ¯è³‡è¨Šï¼Œåƒ…åœ¨é–‹ç™¼ç’°å¢ƒé¡¯ç¤º
- **INFO (1)**ï¼šä¸€èˆ¬è³‡è¨Šï¼Œè¨˜éŒ„æ­£å¸¸çš„æ¥­å‹™æµç¨‹
- **WARN (2)**ï¼šè­¦å‘Šè¨Šæ¯ï¼Œéœ€è¦æ³¨æ„ä½†ä¸å½±éŸ¿åŠŸèƒ½é‹ä½œ
- **ERROR (3)**ï¼šéŒ¯èª¤è¨Šæ¯ï¼Œéœ€è¦ç«‹å³è™•ç†çš„å•é¡Œ

### åˆ†é¡æ¨™ç±¤å®šç¾©
- **API**ï¼šæ‰€æœ‰ API è«‹æ±‚å’Œå›æ‡‰
- **USER**ï¼šç”¨æˆ¶è¡Œç‚ºå’Œæ“ä½œ
- **SYSTEM**ï¼šç³»çµ±äº‹ä»¶å’Œç‹€æ…‹è®ŠåŒ–
- **PERFORMANCE**ï¼šæ•ˆèƒ½ç›¸é—œæ¸¬é‡
- **AI_MANAGER**ï¼šAI æœå‹™ç®¡ç†å’Œåˆ‡æ›
- **NOTION**ï¼šNotion æœå‹™ç›¸é—œæ“ä½œ
- **ERROR_BOUNDARY**ï¼šReact éŒ¯èª¤é‚Šç•Œæ•ç²çš„éŒ¯èª¤
- **ITINERARY_HOOK**ï¼šè¡Œç¨‹è³‡æ–™è™•ç†é‚è¼¯

### ä½¿ç”¨æ–¹å¼

```typescript
import { logger } from '../services/logger-service';

// åŸºæœ¬æ—¥èªŒè¨˜éŒ„
logger.debug('CATEGORY', 'Debug message', { data: 'value' });
logger.info('CATEGORY', 'Info message', { data: 'value' });
logger.warn('CATEGORY', 'Warning message', { data: 'value' }, error);
logger.error('CATEGORY', 'Error message', { data: 'value' }, error);

// API ç›¸é—œä¾¿åˆ©æ–¹æ³•
logger.apiRequest('POST', '/api/notion-query', requestData);
logger.apiResponse('POST', '/api/notion-query', 200, responseData);
logger.apiError('POST', '/api/notion-query', error);

// ç”¨æˆ¶è¡Œç‚ºè¿½è¹¤
logger.userAction('BUTTON_CLICK', { buttonName: 'Generate Description' });

// æ•ˆèƒ½ç›£æ§
logger.performance('Data Processing', 1250, { itemCount: 10 });
```

### æ•ˆèƒ½ç›£æ§ Hook

```typescript
import { usePerformance } from '../hooks/usePerformance';

const { measurePerformance, startMeasurement } = usePerformance();

// æ¸¬é‡æ“ä½œè€—æ™‚
startMeasurement();
await someOperation();
measurePerformance('Operation Name', { context: 'additional data' });
```

### ç”¨æˆ¶è¡Œç‚ºè¿½è¹¤ Hook

```typescript
import { useUserTracking } from '../hooks/useUserTracking';

const { trackUserAction, trackPageView, trackFeatureUsage } = useUserTracking();

// è¿½è¹¤ç”¨æˆ¶è¡Œç‚º
trackUserAction('SEARCH_ITEM', { query: 'travel destination' });
trackPageView('Timeline', { databaseId: 'abc123' });
trackFeatureUsage('AI_DESCRIPTION_GENERATION', { provider: 'gemini' });
```

## æ··åˆæ¶æ§‹è¨­è¨ˆè©³è§£

### ğŸš€ æ¶æ§‹äº®é»

1. **å‰å¾Œç«¯åˆ†é›¢è¨­è¨ˆ**
   - **å‰ç«¯**ï¼šä¿æŒ TypeScript çš„å‹åˆ¥å®‰å…¨å’Œå„ªç§€é–‹ç™¼é«”é©—
   - **å¾Œç«¯**ï¼šä½¿ç”¨ç´” JavaScript ç¢ºä¿ Serverless å¹³å°éƒ¨ç½²ç©©å®šæ€§
   - **å…±ç”¨å·¥å…·**ï¼šutils/notion-client.js æä¾›çµ±ä¸€çš„æ¥­å‹™é‚è¼¯

2. **ç°¡åŒ–çš„å¹³å°æ”¯æ´**
   - ç§»é™¤è¤‡é›œçš„æŠ½è±¡å±¤ï¼Œæ¡ç”¨ç›´æ¥å¯¦ä½œæ–¹å¼
   - æ¯å€‹å¹³å°éƒ½æœ‰ç¨ç«‹çš„ API æª”æ¡ˆï¼Œæ˜“æ–¼ç¶­è­·å’Œèª¿è©¦
   - å…±ç”¨å·¥å…·å‡½æ•¸æ¸›å°‘ä»£ç¢¼é‡è¤‡

3. **çµ±ä¸€éŒ¯èª¤è™•ç†**
   - æ¨™æº–åŒ–çš„ CORS è¨­å®š
   - çµ±ä¸€çš„éŒ¯èª¤å›æ‡‰æ ¼å¼
   - å®Œæ•´çš„è¼¸å…¥é©—è­‰

### ğŸŒ æ”¯æ´çš„éƒ¨ç½²å¹³å°

| å¹³å° | ç‹€æ…‹ | å‡½æ•¸åŸ·è¡Œæ™‚é–“ | API è·¯å¾‘ | ç‰¹è‰² |
|------|------|-------------|----------|------|
| **Netlify** | âœ… å®Œæ•´æ”¯æ´ | 10 ç§’ | `/.netlify/functions/*` | åŸç”Ÿæ”¯æ´ï¼Œé…ç½®ç°¡å–® |
| **Vercel** | âœ… å®Œæ•´æ”¯æ´ | 30 ç§’ (Pro) | `/api/*` | æ›´é•·åŸ·è¡Œæ™‚é–“ï¼Œå…¨çƒé‚Šç·£ç¶²è·¯ |

### ğŸ“ ç°¡åŒ–çš„æ¶æ§‹æª”æ¡ˆ

```
utils/                         # å…±ç”¨å·¥å…·å‡½æ•¸
â””â”€â”€ notion-client.js           # Notion API å…±ç”¨é‚è¼¯

netlify/functions/             # Netlify Functions (JavaScript)
â”œâ”€â”€ notion-query.js
â”œâ”€â”€ notion-create.js
â”œâ”€â”€ notion-update.js
â”œâ”€â”€ notion-delete.js
â”œâ”€â”€ notion-bulk-update.js
â”œâ”€â”€ notion-database-info.js
â””â”€â”€ image-proxy.js

api/                          # Vercel API Routes (JavaScript)
â”œâ”€â”€ notion-query.js
â”œâ”€â”€ notion-create.js
â”œâ”€â”€ notion-update.js
â”œâ”€â”€ notion-delete.js
â”œâ”€â”€ notion-bulk-update.js
â”œâ”€â”€ notion-database-info.js
â””â”€â”€ image-proxy.js

src/services/                 # å‰ç«¯æœå‹™ (TypeScript)
â””â”€â”€ api-service-factory.ts    # æ™ºèƒ½ç«¯é»é¸æ“‡
```

### ğŸ› ï¸ é–‹ç™¼å’Œéƒ¨ç½²æŒ‡ä»¤

```bash
# æœ¬åœ°é–‹ç™¼ï¼ˆæ¨è–¦ï¼‰
npm run dev                   # ä½¿ç”¨ Netlify Devï¼Œå‰ç«¯+API åŒç«¯å£ (8888)

# å…¶ä»–é–‹ç™¼æ¨¡å¼
npm run dev:vite             # åƒ…å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ (5173)
npm run dev:netlify          # Netlify Dev å®Œæ•´ç’°å¢ƒ (8888)
npm run dev:vercel           # Vercel Dev ç’°å¢ƒï¼ˆéœ€è¦å…ˆ vercel loginï¼‰

# å»ºç½®
npm run build                # å»ºç½®å‰ç«¯éœæ…‹æª”æ¡ˆ

# éƒ¨ç½²
netlify deploy --prod        # éƒ¨ç½²åˆ° Netlify
vercel --prod               # éƒ¨ç½²åˆ° Vercel
```

### ğŸ§ª Vercel æœ¬åœ°æ¸¬è©¦æŒ‡å—

è¦åœ¨æœ¬åœ°æ¸¬è©¦ Vercel ç’°å¢ƒï¼š

1. **ç™»å…¥ Vercel CLI**ï¼š
   ```bash
   vercel login
   ```

2. **å•Ÿå‹• Vercel Dev**ï¼š
   ```bash
   npm run dev:vercel
   ```

3. **ç’°å¢ƒè®Šæ•¸è¨­å®š**ï¼š
   - Vercel Dev æœƒè‡ªå‹•è®€å– `.env` æ–‡ä»¶
   - æˆ–åœ¨ Vercel å°ˆæ¡ˆè¨­å®šä¸­é…ç½®ç’°å¢ƒè®Šæ•¸

4. **ç«¯é»æ¸¬è©¦**ï¼š
   - å‰ç«¯ï¼šé€šå¸¸åœ¨ `http://localhost:3000`
   - APIï¼šè‡ªå‹•è™•ç† `/api/*` è·¯ç”±
   - API å·¥å» æœƒè‡ªå‹•é¸æ“‡æ­£ç¢ºçš„ç«¯é»

```

### ğŸ“Š API ç«¯é»è‡ªå‹•é¸æ“‡

å‰ç«¯ `api-service-factory.ts` æœƒæ ¹æ“šç•¶å‰åŸŸåè‡ªå‹•é¸æ“‡æ­£ç¢ºçš„ API ç«¯é»ï¼š

```typescript
// è‡ªå‹•æª¢æ¸¬é‚è¼¯
if (origin.includes('netlify')) â†’ '/.netlify/functions/*'
if (origin.includes('vercel')) â†’ '/api/*'
if (localhost:8888) â†’ '/.netlify/functions/*' (Netlify Dev)
å…¶ä»– â†’ '/.netlify/functions/*' (é è¨­)
```

## ç¶­è­·æ³¨æ„äº‹é …

1. **API é‡‘é‘°å®‰å…¨**ï¼šå®šæœŸæ›´æ› API é‡‘é‘°
2. **Notion API ç‰ˆæœ¬**ï¼šé—œæ³¨ Notion API ç‰ˆæœ¬æ›´æ–°
3. **AI æœå‹™é…é¡**ï¼šç›£æ§ AI æœå‹™ä½¿ç”¨é‡
4. **å¿«å–ç­–ç•¥**ï¼šæ ¹æ“šä½¿ç”¨æƒ…æ³èª¿æ•´å¿«å–æ™‚é–“
5. **æ—¥èªŒç›£æ§**ï¼šå®šæœŸæª¢æŸ¥éŒ¯èª¤æ—¥èªŒï¼ŒåŠæ™‚è™•ç†ç•°å¸¸æƒ…æ³
6. **æ•ˆèƒ½ç›£æ§**ï¼šé—œæ³¨é—œéµæ“ä½œçš„æ•ˆèƒ½æŒ‡æ¨™ï¼Œé©æ™‚æœ€ä½³åŒ–
7. **è·¨å¹³å°æ¸¬è©¦**ï¼šç¢ºä¿ Netlify å’Œ Vercel éƒ½èƒ½æ­£å¸¸é‹ä½œ
8. **ç’°å¢ƒè®Šæ•¸ç®¡ç†**ï¼šç¢ºä¿æ‰€æœ‰å¹³å°çš„ç’°å¢ƒè®Šæ•¸é…ç½®æ­£ç¢º
9. **å…±ç”¨å·¥å…·ç¶­è­·**ï¼š`utils/notion-client.js` è®Šæ›´éœ€åŒæ­¥æ¸¬è©¦å…©å€‹å¹³å°

## æ“´å±•æ–°å¹³å°

è¦æ·»åŠ æ–°çš„éƒ¨ç½²å¹³å°æ”¯æ´ï¼š

1. è¤‡è£½ç¾æœ‰çš„ API å¯¦ä½œï¼ˆå¾ `api/` æˆ– `netlify/functions/`ï¼‰
2. æ ¹æ“šæ–°å¹³å°çš„è¦æ±‚èª¿æ•´æª”æ¡ˆçµæ§‹å’ŒåŒ¯å‡ºæ ¼å¼
3. æ›´æ–° `src/services/api-service-factory.ts` æ·»åŠ æ–°å¹³å°æª¢æ¸¬é‚è¼¯
4. åœ¨ `utils/notion-client.js` ä¸­ç¢ºä¿å…±ç”¨å‡½æ•¸ç›¸å®¹
5. æ–°å¢å°æ‡‰çš„éƒ¨ç½²è…³æœ¬å’Œ npm scripts
6. æ›´æ–°æ­¤æ–‡æª”èªªæ˜æ–°å¹³å°çš„ä½¿ç”¨æ–¹å¼

ç”±æ–¼æ¡ç”¨ç°¡åŒ–æ¶æ§‹ï¼Œæ“´å±•æ–°å¹³å°æ¯”ä»¥å‰çš„æŠ½è±¡å±¤æ–¹å¼æ›´åŠ ç›´æ¥å’Œå¯æ§ã€‚

---

æ­¤å°ˆæ¡ˆå±•ç¾äº†ç¾ä»£ Web æ‡‰ç”¨ç¨‹å¼çš„æœ€ä½³å¯¦è¸ï¼Œæ¡ç”¨æ··åˆæ¶æ§‹è¨­è¨ˆåœ¨ä¿æŒå‰ç«¯ TypeScript å„ªå‹¢çš„åŒæ™‚ï¼Œç¢ºä¿å¾Œç«¯ Serverless å‡½æ•¸çš„éƒ¨ç½²ç©©å®šæ€§ã€‚ç°¡åŒ–çš„æ¶æ§‹æä¾›äº†æ›´å¥½çš„å¯ç¶­è­·æ€§å’Œèª¿è©¦é«”é©—ï¼ŒåŒæ™‚æ”¯æ´å¤šå¹³å°éƒ¨ç½²çš„éˆæ´»æ€§ã€‚